<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>HiveGo - Hive game and AI implemented in Go</title>
    <link rel="icon" href="assets/Icon.png"/>
    <link href="https://fonts.googleapis.com/css?family=Indie+Flower" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Indie+Flower&display=swap/" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"/>
    <link rel="stylesheet" href="./assets/style.css"/>

	<script
	  src="https://code.jquery.com/jquery-2.2.4.min.js"
	  integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
	  crossorigin="anonymous"></script>
    <script src="./wasm/wasm_exec.js"></script>
    <script>
        async function runWasm() {
            try {
                if (!WebAssembly.instantiateStreaming) { // polyfill
                    WebAssembly.instantiateStreaming = async (resp, importObject) => {
                        const source = await (await resp).arrayBuffer();
                        return await WebAssembly.instantiate(source, importObject);
                    };
                }

                const go = new Go();
                const importObject = go.importObject;

                const response = await fetch('./wasm/main.wasm');
                const result = await WebAssembly.instantiateStreaming(response, importObject);
                go.run(result.instance);

                // Assuming your Go/Wasm code has a 'main' function that is now executed by go.run()

            } catch (e) {
                console.error("Error loading and running Wasm:", e);
            }
        }

        runWasm();
    </script>
</head>
<body>
	<svg id="svg_canvas" class="fullscreen" style="background: #F0ED8B; pointer-events: all;" tabindex="0">
        <!-- Definitions (mostly patterns) shared by the SVG elements painted. Most will be created dynamically by the WASM program. -->
        <defs id="svg_defs">
            <pattern id="colors" patternUnits="userSpaceOnUse" width="1024" height="587">
                <image xlink:href="./assets/colors.png" x="0" y="0" width="1024" height="587" />
            </pattern>

            <!-- Tiles used under the pieces: on-board and off-board versions will be scaled differently -->
            <linearGradient id="reliefStroke" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stop-color="#000" stop-opacity="1"/>
                <stop offset="50%" stop-color="#555" stop-opacity="1"/>
                <stop offset="100%" stop-color="#AAA" stop-opacity="1"/>
            </linearGradient>
            <pattern id="offBoardTile0" patternUnits="objectBoundingBox" width="1.0" height="1.2" y="-0.1">
                <image xlink:href="./assets/tile_player_0.png" x="0" y="0" width="1024" height="1024" />
            </pattern>
            <pattern id="offBoardTile1" patternUnits="objectBoundingBox" width="1.0" height="1.2" y="-0.1">
                <image xlink:href="./assets/tile_player_1.png" x="0" y="0" width="1024" height="1024" />
            </pattern>
            <pattern id="onBoardTile0" patternUnits="objectBoundingBox" width="1.0" height="1.2" y="-0.1">
                <image xlink:href="./assets/tile_player_0.png" x="0" y="0" width="1024" height="1024" />
            </pattern>
            <pattern id="onBoardTile1" patternUnits="objectBoundingBox" width="1.0" height="1.2" y="-0.1">
                <image xlink:href="./assets/tile_player_1.png" x="0" y="0" width="1024" height="1024" />
            </pattern>
        </defs>
        <!-- SVG Elements: created dynamically by the WASM program. -->
	</svg>

    <div id="splashScreen" style="display:none; /* Initially hidden */" tabindex="0">
        <h1 style="">hiveGo</h1>
        <div id="github_link" style="text-align: center; margin-top: 0px;">
            <a href="https://github.com/janpfeifer/hiveGo" target="_blank">üîó github.com/janpfeifer/hiveGo üîó</a>
        </div>
        <div id="splash-image-container" class="splash-image-container">
            <img id="splash-image" src="./assets/Grasshopper.png" alt="Splash Screen">
        </div>
    </div>

    <div id="new_game" class="fullscreen" style="display: none;">
        <div class="dialog">
            <form>
                <h3>New Game</h3>
                <label>
                    <input type="radio" name="game_type" id="game_vs_ai" value="ai" checked>
                    Play with AI
                </label>
                <label>
                    <input type="radio" name="game_type" id="hotseat" value="hotseat">
                    Play with a friend ("hotseat")
                </label>

                <h3>AI Settings</h3>
                <label>
                    <input type="radio" name="ai_level" id="easy" value="Easy" checked>
                    Easy
                </label>
                <label>
                    <input type="radio" name="ai_level" id="medium" value="Medium">
                    Medium
                </label>
                <label>
                    <input type="radio" name="ai_level" id="hard" value="Hard">
                    Hard
                </label>

                <label>
                    <input type="checkbox" name="ai_starts" id="ai_starts">
                    AI plays first
                </label>

                <p>Advanced AI config:</p>
                <p><input type="text" name="ai_config" id="ai_config" value=""></p>
                <p><button type="submit" id="start">Start</button></p>
            </form>
        </div>

        <div class="floating-video-container">
            <video class="floating-video" src="./assets/robot.mp4" autoplay loop muted></video>
            <div class="powered-by">
                Powered by <a href="https://github.com/gomlx/gomlx" target="_blank" rel="noopener noreferrer">GoMLX</a>
            </div>
        </div>

    </div>

    <div id="tutorialBox" class="floating-tutorial" style="display: none;">
        <div class="tutorial-header">
            <span id="tutorialTitle">Tutorial</span>
            <button id="tutorialClose" class="close-button">√ó</button>
        </div>
        <div id="tutorialContent" class="tutorial-content">
        </div>
    </div>

    <div id="gameOverBox" class="game-over-modal" style="display: none;">
        <div class="game-over-content">
            <h2 id="gameOverMessage">Game Over!</h2>
            <p id="winnerMessage"></p>
            <button id="restartGame">Restart Game</button>
        </div>
    </div>

    <div id="statusBox" class="floating-status" style="display: none">
        <div class="status-line">
            <span class="clock-icon">üï∞Ô∏è</span><span id="player0Clock">00:00</span>
            <span class="clock-icon">‚è±Ô∏è</span><span id="player1Clock">00:00</span>
        </div>
        <div id="aiEvalRate" class="status-line" style="display: none;">
            AI evals/s: <span id="evalsPerSec">0</span>
        </div>
    </div>

    <div id="ui-buttons" class="floating-ui-buttons">
        <button id="btn-home" title='Center Map (or "Home" key)'>‚õ∂</button>
        <button id="btn-zoom-in" title="Zoom In (or use mouse scroll)">üîé</button>
        <button id="btn-zoom-out" title="Zoom Out (or use mouse scroll)">üîç</button>
        <button id="btn-help" title='Help (or "F1" key)'>‚ùì</button>
    </div>

</body>
</html>